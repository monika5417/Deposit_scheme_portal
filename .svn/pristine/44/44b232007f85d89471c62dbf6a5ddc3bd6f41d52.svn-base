package com.mpcz.deposit_scheme.backend.api.controller;

import java.math.BigDecimal;
import java.util.Arrays;
import java.util.HashMap;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.mpcz.deposit_scheme.backend.api.constant.HttpCode;
import com.mpcz.deposit_scheme.backend.api.domain.PoseMachinePostData;
import com.mpcz.deposit_scheme.backend.api.repository.ConsumerApplictionDetailRepository;
import com.mpcz.deposit_scheme.backend.api.repository.PoseMachinePostDataRepository;
import com.mpcz.deposit_scheme.backend.api.response.Response;
import com.mpcz.deposit_scheme.backend.api.services.PoseMachinePostDataService;

@RestController
@RequestMapping("/poseMachine")
@CrossOrigin(origins = "*", maxAge = 3600)
public class PoseMachinePostDataController {

	@Autowired
	private PoseMachinePostDataService poseMachinePostDataService;

	@Autowired
	private PoseMachinePostDataRepository poseMachinePostDataRepository;

	@PostMapping("/savedata")
	public Response savePoseData(@RequestBody PoseMachinePostData poseMachinePostData) {
		Response response = new Response();

//		code added by monika 6-august-2024
		PoseMachinePostData byApplicationNumber = poseMachinePostDataRepository
				.findByApplicationNumber(poseMachinePostData.getApplicationNumber());
		if (byApplicationNumber != null) {
			response.setCode(HttpCode.NOT_ACCEPTABLE);
			response.setMessage("Application number already submitted");
			return response;
		}
//		code added by monika 6-august-2024

		if (poseMachinePostData.getApplicationNumber().isEmpty()
				|| poseMachinePostData.getApplicationNumber() == null) {
			response.setCode(HttpCode.NULL_OBJECT);
			response.setMessage("Application number is empty ");
			return response;
		}
		int compareTo = poseMachinePostData.getTxnAmount().compareTo(new BigDecimal(0.0));
		if (0 == compareTo) {
			response.setCode(HttpCode.NOT_ACCEPTABLE);
			response.setMessage("Amount  is zero");
			return response;
		}
		if (0 >= compareTo) {
			response.setCode(HttpCode.NOT_ACCEPTABLE);
			response.setMessage("Amount is nagitive ");
			return response;
		}

		try {
			String poseMachinePostDatadb = poseMachinePostDataService.save(poseMachinePostData);
			if (poseMachinePostDatadb.equals("data update succefully")) {
				response.setCode(HttpCode.OK);
				response.setMessage("Data Saved Successfully ");
				response.setList(Arrays.asList(poseMachinePostDatadb));
				return response;

			} else {
				response.setCode(HttpCode.NULL_OBJECT);
				response.setMessage("Data Not Updated ");
				return response;

			}

		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	@GetMapping("/getDemandFeesPaymentDetails/{consumerApplicationNo}")
	public Object getDemandFeesPaymentDetails(@PathVariable String consumerApplicationNo) {
		 return poseMachinePostDataService.getDemandFeesPaymentDetails(consumerApplicationNo);
	}

}
